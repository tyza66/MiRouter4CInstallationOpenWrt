/*!
 * valid.js version 0.1.0
 * Copyright (c) 2014 miwifi.com
 */
(function($){var g=function(el,doc){if("string"==typeof el){if(el.indexOf("<")==0){return $(el)[0]}var retEl=(doc||document).getElementById(el),els;if(retEl&&retEl.id!=el){els=(doc||document).getElementsByName(el);for(var i=0;i<els.length;i++){if(els[i].id==el){return els[i]}}return null}return retEl}else{return(ObjectH.isWrap(el))?arguments.callee(el[0]):el}},getAttr2=function(el,attr){return el[attr]||el.getAttribute(attr)||getJsAttr(el,attr)},mix=ObjectH.mix,trim=StringH.trim,tmpl=StringH.tmpl,dbc2sbc=StringH.dbc2sbc,byteLen=function(str){var m=encodeURIComponent(str).match(/%[89ABab]/g);return str.length+(m?m.length:0)},evalExp=StringH.evalExp,formatDate=QW.DateH.format,getValue=function(el){return trim(g(el).value)},CustEvent=QW.CustEvent;QW.NodeH={g:g};var getJsAttr=function(el,attribute){var CheckRules=Valid.CheckRules;if(!CheckRules){return null}attribute=attribute.toLowerCase();el=g(el);var keys=[];if(el.id){keys.push("#"+el.id)}if(el.name){keys.push("@"+el.name)}keys=keys.concat(el.className.match(/\.[\w\-]+/g)||[],(el.tagName+"").toLowerCase());for(var i=0,len=keys.length;i<len;i++){var key=keys[i];if((key in CheckRules)&&(attribute in CheckRules[key])){return CheckRules[key][attribute]}}return null};var Valid={VERSION:"0.0.1",EVENTS:"hint,blur,pass,fail,beforecheckall,checkall,initall".split(","),REQ_ATTR:"reqMsg",_curReqAttr:"reqMsg"};CustEvent.createEvents(Valid,Valid.EVENTS);mix(Valid,{hint:function(el){Valid.fire(new CustEvent(el,"hint"))},blur:function(el){Valid.fire(new CustEvent(el,"blur"))},pass:function(el){Valid.fire(new CustEvent(el,"pass"))},fail:function(el,errMsg,needFocus){if(needFocus){Valid.focusFailEl(el)}var ce=new CustEvent(el,"fail");ce.errMsg=errMsg;setTimeout(function(){Valid.fire(ce)},0)},checkAll_stamp:1,isChecking:false,checkAll:function(oForm,needFocus,opts){needFocus=(needFocus!=false);var ce=new CustEvent(oForm,"beforecheckall");ce.opts=opts||{};Valid.fire(ce);Valid.isChecking=true;var els=oForm.elements,failEls=[];for(var i=0,el;el=els[i++];){if(!getAttr2(el,"forceVld")&&(el.disabled||el.readOnly||!el.offsetWidth)){continue}if(!Valid.check(el,false,opts)){failEls.push(el)}}var isOk=!failEls.length;var ce2=new CustEvent(oForm,"checkall");ce2.result=isOk;ce2.failEls=failEls;Valid.fire(ce2);Valid.isChecking=false;Valid.checkAll_stamp++;if(!isOk&&needFocus){window.setTimeout(function(){Valid.check(failEls[0],true,opts)},10)}return isOk},check:function(el,needFocus,opts){if(!Validators.required(el)||getAttr2(el,"datatype")&&!Validators.datatype(el)||(opts&&opts.myValidator&&!opts.myValidator(el))){if(needFocus){Valid.focusFailEl(el);Valid.check(el,false,opts)}return false}return true},renderResult:function(el,result,errMsg,needFocus){if(result){Valid.pass(el)}else{Valid.fail(el,errMsg,needFocus)}},focusFailEl:function(el){var fEl=getAttr2(el,"focusEl");fEl=fEl&&g(fEl)||el;try{fEl.focus();if(!fEl.tagName){return}fEl.select()}catch(e){}},initAll:function(container){if(!Valid._isInitialized){Valid._isInitialized=true;if(document.addEventListener){document.addEventListener("focus",function(e){var el=e.target;if(el&&",INPUT,SELECT,TEXTAREA,OBJECT".indexOf(","+el.tagName)>-1){Valid.hint(el)}},true);document.addEventListener("blur",function(e){var el=e.target;if(el&&",INPUT,SELECT,TEXTAREA,OBJECT".indexOf(","+el.tagName)>-1){Valid.blur(el)}},true);document.addEventListener("click",function(e){var el=e.target;if(el.type=="checkbox"||el.type=="radio"){Valid.blur(el)}})}else{document.attachEvent("onfocusin",function(e){Valid.hint(e.srcElement)});document.attachEvent("onfocusout",function(e){Valid.blur(e.srcElement)})}}var els=$(container).find("input");for(var i=0;i<els.length;i++){Valid.initEl(els[i])}var ce=new CustEvent(container,"initall");Valid.fire(ce)},initEl:function(el){var dataType=getAttr2(el,"datatype");if(dataType=="d"||dataType=="daterange"){var nextEl=el.nextSibling;if(nextEl&&nextEl.tagName=="IMG"){return}var img=Utils.getCalendarImg().cloneNode(true);img.onclick=function(e){Utils.pickDate(el)};el.parentNode.insertBefore(img,nextEl)}},resetAll:function(oForm){var els=oForm.elements;for(var i=0,el;el=els[i++];){Valid.pass(el)}}});var Msgs=Valid.Msgs=mix(i18n.valid,{getMsg:function(el,msgKey){return getAttr2(el,msgKey)||getAttr2(el,"errmsg")||Msgs[msgKey]||msgKey}});var Utils=Valid.Utils={setTextValue:function(el,value){if(el.createTextRange){el.createTextRange().text=value}else{el.value=value}},trimTextValue:function(el){var s=trim(el.value);if(s!=el.value){Utils.setTextValue(el,s)}},dbc2sbcValue:function(el){var s=dbc2sbc(getValue(el));if(s!=getValue(el)){Utils.setTextValue(el,s)}},prepare4Vld:function(el){if(getAttr2(el,"ignoredbc")){Utils.dbc2sbcValue(el)}if(el.type=="text"||el.type=="textarea"){Utils.trimTextValue(el)}}};var Validators=Valid.Validators={};mix(Validators,[{required:function(el,renderResult){Utils.prepare4Vld(el);var reqAttr=Valid._curReqAttr||Valid.REQ_ATTR;var sReq=getAttr2(el,reqAttr);if(sReq){var reqlogic=getAttr2(el,"reqlogic");if(reqlogic){return Validators.logicrequired(el,renderResult,reqlogic)}else{var isOk=false;var msgKey="_req_text";if(el.tagName=="SELECT"){isOk=(el.value!=""||el.length<2||(el.length==2&&el.options[1].value==""));msgKey="_req_select"}else{if(el.type=="checkbox"||el.type=="radio"){var els=document.getElementsByName(el.name);for(var i=0;i<els.length;i++){if(isOk=els[i].checked){break}}msgKey="_req_select"}else{isOk=(getValue(el)!="");if(el.type=="file"){msgKey="_req_file"}}}if(renderResult!=false){Valid.renderResult(el,isOk,!isOk&&sReq.indexOf(" ")==0?sReq.substr(1):tmpl(Msgs[msgKey],[sReq]))}return isOk}}return true},datatype:function(el,renderResult,datatype){datatype=datatype||getAttr2(el,"datatype");if(!datatype){Valid.pass(el,renderResult);return true}var dt=datatype.split("-")[0].toLowerCase(),pattern=datatype.substr(dt.length+1),cb=Validators[dt];if(!cb){throw"Unknown datatype: "+datatype}return pattern?cb(el,renderResult,pattern):cb(el,renderResult)},n:function(el,renderResult,pattern){Utils.prepare4Vld(el);Utils.dbc2sbcValue(el);var val=getValue(el);var isOk=(val=="");var msg=null;if(!isOk){var patternArr=(pattern||getAttr2(el,"n-pattern")||"10").split(".");var len=patternArr[0]|0||10,precision=patternArr[1]|0;if(precision<1){if((/\D/).test(val)||val.length>len){msg=tmpl(Msgs.getMsg(el,"n_integer"),[len])}}else{var s="^\\d{1,100}(\\.\\d{1,"+precision+"})?$";if(!(new RegExp(s)).test(val)){msg=tmpl(Msgs.getMsg(el,"n_format"),[(new Array(len-precision+1)).join("X")+"."+(new Array(precision+1)).join("X")])}}if((/^0\d/).test(val)){msg=Msgs.getMsg(el,"n_useless_zero")}if(!msg){var maxV=getAttr2(el,"maxValue")||Math.pow(10,len-precision)-Math.pow(10,-precision);if(maxV&&